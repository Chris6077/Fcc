var data;$(document).ready(function(){AOS.init({disable:"mobile"})}),$(document).ready(()=>{d3.json("https://cdn.rawgit.com/freeCodeCamp/testable-projects-fcc/a80ce8f9/src/data/tree_map/video-game-sales-data.json").then(t=>{data=t,draw(),$(window).resize(()=>{draw()})})});let draw=()=>{$("main")[0].innerHTML="",$(".tooltip").remove();let t=70,e=90,a=30,i=30,d=[800,document.documentElement.clientHeight/2],r={h:t+d[1]+e,w:i+d[0]+a},n=20,s=5,l=5,h=800,o=d3.schemePaired.concat(d3.schemeDark2),c=d3.hierarchy(data);c.sum(t=>t.value).sort((t,e)=>e.value-t.value);let p=d3.treemap();p.size(d);let g=p(c).descendants(),m=g.reduce((t,e)=>(0!==e.depth&&e.height>0&&!t.includes(e.data.name)&&t.push(e.data.name),t),[]),u=d3.select("main").append("svg").attr("height",r.h).attr("width",r.w),x=u.append("g").attr("transform",e=>`translate(${i},${t})`).attr("height",d[0]).attr("width",d[1]),f=u.append("g").attr("id","legend").attr("height",2*s+n).attr("transform",e=>`translate(${i},${t+d[1]})`),y=d3.select("body").append("div").style("opacity",0).attr("id","tooltip").attr("data-value",0).attr("class","tooltip");let w=x.selectAll("rect").data(g).enter().append("g").attr("transform",t=>`translate(${t.x0},${t.y0})`);w.append("rect").attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).attr("class","tile").style("stroke","white").attr("fill",t=>o[m.indexOf(0===t.height?t.data.category:t.data.name)]).attr("data-name",t=>t.data.name).attr("data-category",t=>0===t.height?t.data.category:t.data.name).attr("data-value",t=>t.value).on("mouseover",t=>{y.html(`Name: ${t.data.name}</br>Category: ${t.data.category}</br>Value:${t.data.value}`).attr("data-value",t.value).style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-20+"px"),y.transition().duration(100).style("opacity",.9)}).on("mouseout",()=>{y.transition().duration(300).style("opacity",0)}),w.append("text").attr("dx",4).attr("dy",15).each(function(t){if(0===t.height){var e=(t.x1-t.x0)/5,a=t.data.name.split(" ")[0],i=t.x1-t.x0,d=t.y1-t.y0;for(d3.select(this).style("font-size",e+"px").text(a);(this.getBBox().width>=i||this.getBBox().height>=d)&&e>12;)e--,d3.select(this).style("font-size",e+"px"),this.firstChild.data=a}}).each(function(t){if(0===t.height){var e,a=t.data.name.split(" "),i=new Array,d="",r=t.x1-t.x0,n=t.y1-t.y0;do{if(e=a.shift(),i.push(e),a.length?this.firstChild.data=i.join(" ")+" "+a[0]:this.firstChild.data=i.join(" "),this.getBBox().width<r&&a.length);else{if(d=i.join(" "),this.firstChild.data=d,this.getBBox().width>r){d=d3.select(this).select(function(){return this.lastChild}).text(),d+="...",d3.select(this).select(function(){return this.lastChild}).text(d),d3.select(this).classed("wordwrapped",!0);break}if(""!=d&&d3.select(this).append("svg:tspan").attr("x",0).attr("dx","0.15em").attr("dy","0.9em").text(d),this.getBBox().height>n&&a.length){d=d3.select(this).select(function(){return this.lastChild}).text(),d+="...",d3.select(this).select(function(){return this.lastChild}).text(d),d3.select(this).classed("wordwrapped",!0);break}i=new Array}}while(a.length);this.firstChild.data=""}});let v=x.append("text").attr("id","title").text("Video Game Sales"),C=x.append("text").attr("id","description").html("Top 100 Most Sold Video Games Grouped by Platform");v.attr("x",i+d[0]/2-v.node().getBoundingClientRect().width/2).attr("y",-(v.node().getBoundingClientRect().height/2+20)),C.attr("x",i+d[0]/2-C.node().getBoundingClientRect().width/2).attr("y",-(-v.node().getBoundingClientRect().height+C.node().getBoundingClientRect().height+20));f.selectAll("g").data(m).enter().append("rect").attr("height",n).attr("width",n).attr("class","legend-item").attr("fill",(t,e)=>o[e]).attr("stroke","black").attr("transform",(t,e)=>e<9?`translate(${l+(l+h/9.25)*e},${s})`:`translate(${l+(l+h/9.25)*(e-9)},${2*s+n})`);f.selectAll("g").data(m).enter().append("text").text(t=>t).attr("transform",(t,e)=>e<9?`translate(${l+n+(l+h/9.25)*e+3},${s+n-3})`:`translate(${l+n+(l+h/9.25)*(e-9)+3},${2*s+2*n-3})`);setTimeout(()=>{$("#preloader").fadeOut(500)},500);setTimeout(()=>{$("#preloader").remove()},1100);};